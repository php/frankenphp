# Логирование

FrankenPHP легко интегрируется с [системой логирования Caddy](https://caddyserver.com/docs/logging).
Вы можете логировать сообщения, используя стандартные функции PHP, или воспользоваться специализированной функцией `frankenphp_log()` для расширенных возможностей структурированного логирования.

## `frankenphp_log()`

Функция `frankenphp_log()` позволяет отправлять структурированные логи непосредственно из вашего PHP-приложения,
что значительно упрощает их прием в такие платформы, как Datadog, Grafana Loki или Elastic, а также поддерживает OpenTelemetry.

По своей сути, `frankenphp_log()` является оберткой для [пакета Go `log/slog`](https://pkg.go.dev/log/slog), предоставляя богатые возможности логирования.

Эти логи включают уровень серьезности и необязательные контекстные данные.

```php
function frankenphp_log(string $message, int $level = FRANKENPHP_LOG_LEVEL_INFO, array $context = []): void
```

### Параметры

- **`message`**: Строка сообщения лога.
- **`level`**: Уровень серьезности лога. Может быть любым произвольным целым числом. Для распространенных уровней предусмотрены константы: `FRANKENPHP_LOG_LEVEL_DEBUG` (`-4`), `FRANKENPHP_LOG_LEVEL_INFO` (`0`), `FRANKENPHP_LOG_LEVEL_WARN` (`4`) и `FRANKENPHP_LOG_LEVEL_ERROR` (`8`). По умолчанию установлено значение `FRANKENPHP_LOG_LEVEL_INFO`.
- **`context`**: Ассоциативный массив дополнительных данных, которые будут включены в запись лога.

### Пример

```php
<?php

// Записываем простое информационное сообщение
frankenphp_log("Привет из FrankenPHP!");

// Записываем предупреждение с контекстными данными
frankenphp_log(
    "Высокое потребление памяти",
    FRANKENPHP_LOG_LEVEL_WARN,
    [
        'current_usage' => memory_get_usage(),
        'peak_usage' => memory_get_peak_usage(),
    ],
);

```

При просмотре логов (например, через `docker compose logs`) вывод будет выглядеть как структурированный JSON:

```json
{"level":"info","ts":1704067200,"logger":"frankenphp","msg":"Hello from FrankenPHP!"}
{"level":"warn","ts":1704067200,"logger":"frankenphp","msg":"Memory usage high","current_usage":10485760,"peak_usage":12582912}
```

## `error_log()`

FrankenPHP также позволяет логировать с помощью стандартной функции `error_log()`. Если параметр `$message_type` равен `4` (SAPI),
эти сообщения направляются в логгер Caddy.

По умолчанию сообщения, отправленные через `error_log()`, обрабатываются как неструктурированный текст.
Они полезны для совместимости с существующими приложениями или библиотеками, которые полагаются на стандартную библиотеку PHP.

### Пример с error_log()

```php
error_log("Сбой подключения к базе данных", 4);
```

Это появится в логах Caddy, часто с префиксом, указывающим на то, что сообщение пришло из PHP.

> [!TIP]
> Для лучшей наблюдаемости в production-средах предпочитайте `frankenphp_log()`,
> так как она позволяет фильтровать логи по уровню (Debug, Error и т.д.)
> и запрашивать определенные поля в вашей инфраструктуре логирования.
